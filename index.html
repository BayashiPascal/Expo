<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <style>
html { width: 100%; height: 100%; }
body {
  background-color: #aaaaaa; color: #433126;
  font-family:  serif; font-size: 40px;
  width: 100%; height: 100%;
  margin: 0;
  overflow: hidden;
}
#pages {
  margin: auto; padding: 10px;
  height: 100%;
  display: flex; flex-direction: column;
  justify-content: center; align-items: center;
}
.page {
  display: none;
  margin: auto; padding: 10px; vertical-align: middle;
}
.pageTitle { font-size: 60px; text-align: center; }
.prePostPage {
  clear: both; position: absolute; width: 100%;
  text-align: center; font-size: 20px;
}
#header { height: 50px; margin-top: 0px; }
#footer { height: 25px; margin-top: -50px; }
#status { height: 25px; margin-top: -75px; }
    </style>
  </head>
  <title> Title of the presentation </title>
  <body id="body">
    <div class="prePostPage" id="header">
Header of the pages
    </div>
    <div id="pages">

      <div class="page">
Content of the page
      </div>

      <div class="page">
Content of another page
      </div>

   </div>
   <div class="prePostPage" id="footer">
Footer of the pages
   </div>
   <div class="prePostPage" id="status"></div>
  </body>
  <script>
// Helper function that return the required range of integer as an array
function range(size, startAt = 0) {
  return [...Array(size).keys()].map(i => i + startAt);
}

// Helper function to get an element in the DOM from its id
function elem(id) { return document.getElementById(id); }

// Instance of the main class
let myExpo = {};

// Main class
class Expo {
  // Constructor
  constructor() {
    // Index of the current page
    this.curPage = 0;
    // Number of pages
    this.nbPage = document.querySelectorAll('#pages .page').length;
  }
  // Move to the previous page
  prevPage() { if(this.curPage > 0) this.curPage -= 1; }
  // Move to the next page
  prevPage() { if(this.curPage < this.nbPage - 1) this.curPage += 1; }
  // Display the current page
  showCurrentPage() {
    // Hide all the pages
    document.querySelectorAll('#pages .page').forEach(
      page => page.style.display = "none");
    // Display the current page
    let curPage = document.querySelectorAll('#pages .page')[this.curPage];
    curPage.style.display = "block";
    // Update the status
    elem("status").innerHTML = (this.curPage + 1) + "/" + this.nbPage;
  }
}

// Hanlder for the onload event
window.onload = function() {
  // Add the event handler for the key press
  elem("body").addEventListener("keydown", KeyPressed);
  // Create the instance of the main class
  myExpo = new Expo();
  // Set the current page to 1 or the page requested through the url
  // (.../index.html?page=XXX)
  queryString = window.location.search;
  urlParams = new URLSearchParams(queryString);
  reqPage = urlParams.get('page');
  page = parseInt(reqPage);
  if(isNaN(page)) page = 1;
  myExpo.curPage = page - 1;
  // Display the current page
  myExpo.showCurrentPage();
}

// Handler for the keypress events
function KeyPressed(evt) {
  // Cursor left
  if(evt.keyCode == 37) myExpo.prevPage();
  // Cursor right
  else if(evt.keyCode == 39) myExpo.nextPage();
  // Ignore other keys
  else return;
  // Display the new current page
  myExpo.showCurrentPage();
  // Avoid the event to bubble up
  evt.preventDefault();
}



/*
// ------------ Global variables


// ------------ Body.OnLoad handler

function BodyOnLoad() {
  try {
 
    queryString = window.location.search;
    urlParams = new URLSearchParams(queryString);
    reqPage = urlParams.get('page');
 
    console.log("Requested page <" + reqPage + "> from URL");

    myExpo = new Expo();

    $("body").keydown(BodyKeyPressed);
 
    myExpo.HideAllPages();
    myExpo.CreateTOC();
    myExpo.ToggleTOC();
 
    page = parseInt(reqPage);
    if (isNaN(page)) {
      page = 1;
    }
    myExpo.MoveToPage(page - 1);

  } catch (err) {
    console.log("BodyOnLoad " + err.stack);
  }
}

// ------------ Keyboard events handler


// ------------ Expo class


Expo.prototype.GetNbPages = function(page) {
  try {

    return $("#pages .page").length;

  } catch (err) {
    console.log("Expo.GetNbPages " + err.stack);
  }
}

function sleep(time) {
    return new Promise(resolve => {
        setTimeout(() => {
            resolve();
        }, time);
    });
}

Expo.prototype.ShowPage = async function(page) {
  try {

    if (page == this.curPage) {
      return;
    }
    while (this.isUnderTransition) {
      await sleep(100);
    }
    this.isUnderTransition = true;
    this.prevPage = $("#pages .page")[this.curPage];
    if (this.curPage > page) {
      this.fadeOut = "animate__backOutRight";
      this.fadeIn = "animate__backInLeft";
    } else {
      this.fadeOut = "animate__backOutLeft";
      this.fadeIn = "animate__backInRight";
    }
    $("#status").html((page+1) + "/" + this.GetNbPages());
    this.curPage = page;
    if (this.prevPage) {
      this.prevPage.classList.add('animate__animated', this.fadeOut);
    }
    setTimeout(function() {
        if (myExpo.prevPage) {
          myExpo.prevPage.style.display = "none";
          myExpo.prevPage.classList.remove('animate__animated', myExpo.fadeOut);
        }
        console.log("Show page " + myExpo.curPage);
        curPage = $("#pages .page")[myExpo.curPage];
        curPage.style.display = "block";
        curPage.classList.add('animate__animated', myExpo.fadeIn);
        setTimeout(function() {
            curPage = $("#pages .page")[myExpo.curPage];
            curPage.classList.remove('animate__animated', myExpo.fadeIn);            
            myExpo.isUnderTransition = false;
          }, 1000);
      }, 1000);

  } catch (err) {
    console.log("Expo.ShowCurPage " + err.stack);
  }
}

Expo.prototype.MoveToPage = function(page) {
  try {

    console.log("Move to " + page);

    if (page >= 0 && page < this.GetNbPages()) {
      this.ShowPage(page);
    }

  } catch (err) {
    console.log("Expo.MoveToPage " + err.stack);
  }
}


Expo.prototype.HideAllPages = function() {
  try {

    $(".page").css("display", "none");

  } catch (err) {
    console.log("Expo.HideAllPages " + err.stack);
  }
}

Expo.prototype.CreateTOC = function() {
  try {

    this.toc = document.createElement("ol");
    $(".page").each(function(index, page) {
        pageTitle = page.getAttribute("data-title");
        if (pageTitle) {
          a = document.createElement("a");
          a.href = "index.html?page=" + (index+1);
          a.innerHTML = pageTitle + " (p." + (index+1) + ")";
          a.className = "tocLink"; 
          li = document.createElement("li");
          li.append(a);
          myExpo.toc.append(li);
        }
      })
    $("#tocContent").append(this.toc);

  } catch (err) {
    console.log("Expo.CreateTOC " + err.stack);
  }
}

Expo.prototype.ToggleTOC = function() {
  try {

    if (this.isTOCDisplayed) {

      $("#toc").css("display", "none");
      $("#pages").css("display", "flex");
      $("#status").css("display", "block");
      this.isTOCDisplayed = false;

    } else {

      $("#toc").css("display", "block");
      $("#pages").css("display", "none");
      $("#status").css("display", "none");
      this.isTOCDisplayed = true;

    }

  } catch (err) {
    console.log("Expo.ToggleTOC " + err.stack);
  }
}
*/
  </script> 
</html>
